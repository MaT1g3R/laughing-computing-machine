version: '2.1'

jobs:
  tests:
    resource_class: small
    docker:
      - image: alpine
    steps:
      - checkout
      - run:
          name: make workspace
          command: |
            mkdir -p /tmp/dir/foo
            echo aaaaaa > /tmp/dir/foo/a
      - persist_to_workspace:
          root: /tmp/dir
          paths:
            - foo
      - attach_to_workspace:
          at: /tmp/dir
      - restore_cache:
          keys:
            - rspec
      - save_cache:
          key: rspec
          paths:
            - rspec.xml
      - store_test_results:
          path: rspec.xml
      - store_artifacts:
          path: rspec.xml
workflows:
  the_workflow:
    jobs:
      - tests
